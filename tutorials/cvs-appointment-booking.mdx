---
title: "CVS Appointment Booking"
description: "Use the OAGI Python SDK's TaskerAgent to schedule a CVS vaccination appointment end-to-end."
---

# CVS Appointment Booking Tutorial

Automate a multi-step CVS vaccination appointment with the OAGI Python SDK. We'll assemble the workflow piece by piece—starting with environment setup, then layering agents, todos, and observability—before revealing the full script at the end.

<Warning>
  **US only** — CVS.com appointment booking is only available in the United States. If you're outside the US, try the [Amazon Data Crawling](/examples/tasker/amazon-data-crawling) or [Nike Shopping](/examples/actor/nike-shopping) examples instead.
</Warning>

## What You'll Build

- Launch cvs.com, search for the vaccinations flow, and open the scheduling experience
- Populate contact and birthday fields without relying on browser autofill
- Select vaccines, provide a ZIP code, and submit a search for nearby appointments
- Export a full HTML run history for auditing or support tickets

## Prerequisites

1. **OAGI credentials** – Generate an API key at [developer.openagi.org](https://developer.openagi.org/) and export it in your shell:
   ```bash
   export OAGI_API_KEY="sk-your-key"
   export OAGI_BASE_URL="https://api.agiopen.org"  # optional override
   ```
2. **Python ≥ 3.10 with desktop extras** – Install the metapackage (pulls in PyAutoGUI + Pillow) or target extras explicitly:
   ```bash
   pip install "oagi>=0.10.1"
   # or: pip install "oagi-core[desktop]"
   ```
3. **macOS permissions** – Grant accessibility/screen recording access so PyAutoGUI and screenshot capture can control the OS.
4. **Chrome/Edge/Firefox** open and authenticated as needed for CVS bookings.

## Project Layout

Create a `tutorials/cvs` folder with:

- `cvs_tasker.py` – main script
- `results/` – destination for exported HTML transcripts

```
tutorials/cvs/
├── cvs_tasker.py
└── results/
```

## Tutorial Roadmap

We'll assemble the script in six small steps:

1. Bootstrap the project and async entry point
2. Accept personalization input through `argparse`
3. Initialize the automation toolkit (observer, screenshot maker, action handler)
4. Describe the CVS workflow as todos
5. Execute the agent while streaming telemetry
6. Export the run transcript for auditing

Only after these steps will we reveal the consolidated source.

### Step 1 — Bootstrap the project

Start with an async entry point and the imports you'll need later:

```python
import argparse
import asyncio
import os
import traceback
from datetime import datetime

from oagi import AsyncScreenshotMaker
from oagi.agent.observer import AsyncAgentObserver
from oagi.agent.tasker import TaskerAgent
from oagi.handler import AsyncPyautoguiActionHandler


async def main():
    print("Bootstrapping CVS Tasker…")


if __name__ == "__main__":
    asyncio.run(main())
```

This skeleton ensures macOS accessibility prompts happen once when `AsyncPyautoguiActionHandler` first loads.
It also establishes an async context up front so later sections can drop in awaitable calls (observer exports, agent execution).

### Step 2 — Collect run arguments

Parameterize the run so you can swap contact details or models without editing the file:

```python
    parser = argparse.ArgumentParser(
        description="Run TaskerAgent to schedule a CVS appointment"
    )

    # CVS contact info
    parser.add_argument("--first_name", default="First")
    parser.add_argument("--last_name", default="Last")
    parser.add_argument("--email", default="user@example.com")
    parser.add_argument("--birthday", default="MM-DD-YYYY")
    parser.add_argument("--zip_code", default="00000")

    # run config
    parser.add_argument("--exp_name", default="cvs")
    parser.add_argument("--save_dir", default="results")

    # agent config
    parser.add_argument("--model_name", default="lux-actor-1")
    parser.add_argument("--max_steps", type=int, default=24)
    parser.add_argument("--temperature", type=float, default=0.0)

    args = parser.parse_args()
    save_dir = os.path.join(args.save_dir, args.exp_name)
    os.makedirs(save_dir, exist_ok=True)
```

### Step 3 — Initialize the automation toolkit

Wire up the observation stack (`AsyncAgentObserver`) plus the desktop automation primitives. These pull in optional dependencies defined in the `desktop` extra. @oagi-python/src/oagi/__init__.py#35-93

```python
    observer = AsyncAgentObserver()
    image_provider = AsyncScreenshotMaker()
    action_handler = AsyncPyautoguiActionHandler()

    tasker = TaskerAgent(
        api_key=os.getenv("OAGI_API_KEY"),
        base_url=os.getenv("OAGI_BASE_URL", "https://api.agiopen.org"),
        model=args.model_name,
        max_steps=args.max_steps,
        temperature=args.temperature,
        step_observer=observer,
    )
```

`TaskerAgent` layers planning, memory, and observers on top of the core actor loop. @oagi-python/src/oagi/agent/tasker/tasker_agent.py#23-166

### Step 4 — Describe the CVS workflow

Break the appointment journey into todos so each successful step is clearly defined for the agent.

```python
    month, day, year = args.birthday.split("-")
    instruction = (
        f"Schedule an appointment at CVS for {args.first_name} {args.last_name} "
        f"with email {args.email} and birthday {args.birthday}"
    )
    todos = [
        "Open a new tab, go to www.cvs.com, type 'flu shot' in the search bar and press enter, wait for the page to load, then click on the button of Schedule vaccinations on the top of the page",
        f"Enter the first name '{args.first_name}', last name '{args.last_name}', and email '{args.email}' in the form. Do not use any suggested autofills. Make sure the mobile phone number is empty.",
        f"Slightly scroll down to see the date of birth, enter Month '{month}', Day '{day}', and Year '{year}' in the form",
        "Click on 'Continue as guest' button, wait for the page to load with wait, click on 'Add vaccines' button, select 'Flu' and click on 'Add vaccines'",
        f"Click on 'next' to enter the page with recommendation vaccines, then click on 'next' again, until on the page of entering zip code, enter '{args.zip_code}', select the first option from the dropdown menu, and click on 'Search'",
    ]

    tasker.set_task(
        task=instruction,
        todos=todos
    )
```

Tip: Keep instructions declarative (“click X”) so the model knows when to wait for UI updates.
Modeling steps as todos mirrors Tasker’s internal memory model, giving you clear success checkpoints instead of one monolithic “done” signal.

### Step 5 — Execute and inspect memory

Kick off the agent, then summarize the replay directly from `PlannerMemory`.

```python
    print(f"Starting task execution at {datetime.now()}")
    print("=" * 60)

    try:
        success = await tasker.execute(
            instruction="",
            action_handler=action_handler,
            image_provider=image_provider,
        )

        memory = tasker.get_memory()
        print("\n" + "=" * 60)
        print("EXECUTION SUMMARY")
        print(f"Overall success: {success}")
        print(memory.task_execution_summary)

        status_summary = memory.get_todo_status_summary()
        print(f"Completed: {status_summary.get('completed', 0)}")
    except Exception as exc:
        print(f"Error during execution: {exc}")
        traceback.print_exc()
```

`TaskerAgent` will emit split events to any registered observer so you can stream state to dashboards or logs.

### Step 6 — Export the run transcript

Store an HTML artifact for reviews or compliance checks.

```python
    output_file = os.path.join(save_dir, "cvs_execution_history.html")
    observer.export("html", output_file)
    print(f"Exported execution history to {output_file}")
```

At this point you have a working automation assembled from reusable building blocks.
Exporting directly from the observer keeps presentation logic decoupled from the Tasker, so you can later swap in Markdown/JSON exports without touching the execution core.

## Run the Workflow

Launch the automation (make sure CVS is reachable and the browser window is visible):

```bash
python cvs_tasker.py \
  --first_name="First" \
  --last_name="Last" \
  --email="user@example.com" \
  --birthday="MM-DD-YYYY" \
  --zip_code="00000" \
  --model_name="lux-actor-1" \
  --max_steps=30
```

> Tip: Run inside a dedicated desktop Space to avoid accidental mouse/keyboard interruptions.

## Understanding the Output

- **Console summary** – Displays per-todo success, and aggregated stats pulled from the agent's memory object.
- **HTML export** – Stored under `results/<exp_name>/cvs_execution_history.html` with screenshot thumbnails, tool calls, and timestamps for every step (ideal proof for compliance or debugging).

## Troubleshooting

| Symptom | Likely cause | Fix |
| --- | --- | --- |
| `ImportError: AsyncPyautoguiActionHandler requires desktop dependencies` | Desktop extras not installed | `pip install oagi-core[desktop]` @oagi-python/src/oagi/__init__.py#35-93 |
| `ConfigurationError: OAGI API key must be provided` | Missing `OAGI_API_KEY` | Export env var or pass `api_key` directly. @oagi-python/src/oagi/client/base.py#42-58 |
| Agent stalls on a todo | UI element not visible yet | Increase `--max_steps`, add `wait` language inside the todo, or lower `--temperature` for deterministic retries. |

## Full Source Listing

Here is the complete script assembled from the steps above:

```python
import argparse
import asyncio
import os
import traceback
from datetime import datetime

from oagi import AsyncScreenshotMaker
from oagi.agent.observer import AsyncAgentObserver
from oagi.agent.tasker import TaskerAgent
from oagi.handler import AsyncPyautoguiActionHandler


async def main():
    parser = argparse.ArgumentParser(
        description="Run TaskerAgent to schedule a CVS appointment"
    )

    # CVS contact info
    parser.add_argument("--first_name", default="First")
    parser.add_argument("--last_name", default="Last")
    parser.add_argument("--email", default="user@example.com")
    parser.add_argument("--birthday", default="MM-DD-YYYY")
    parser.add_argument("--zip_code", default="00000")

    # run config
    parser.add_argument("--exp_name", default="cvs")
    parser.add_argument("--save_dir", default="results")

    # agent config
    parser.add_argument("--model_name", default="lux-actor-1")
    parser.add_argument("--max_steps", type=int, default=24)
    parser.add_argument("--temperature", type=float, default=0.0)

    args = parser.parse_args()

    save_dir = os.path.join(args.save_dir, args.exp_name)
    os.makedirs(save_dir, exist_ok=True)

    observer = AsyncAgentObserver()
    image_provider = AsyncScreenshotMaker()
    action_handler = AsyncPyautoguiActionHandler()

    tasker = TaskerAgent(
        api_key=os.getenv("OAGI_API_KEY"),
        base_url=os.getenv("OAGI_BASE_URL", "https://api.agiopen.org"),
        model=args.model_name,
        max_steps=args.max_steps,
        temperature=args.temperature,
        step_observer=observer,
    )

    month, day, year = args.birthday.split("-")
    instruction = (
        f"Schedule an appointment at CVS for {args.first_name} {args.last_name} "
        f"with email {args.email} and birthday {args.birthday}"
    )
    todos = [
        "Open a new tab, go to www.cvs.com, type 'flu shot' in the search bar and press enter, wait for the page to load, then click on the button of Schedule vaccinations on the top of the page",
        f"Enter the first name '{args.first_name}', last name '{args.last_name}', and email '{args.email}' in the form. Do not use any suggested autofills. Make sure the mobile phone number is empty.",
        f"Slightly scroll down to see the date of birth, enter Month '{month}', Day '{day}', and Year '{year}' in the form",
        "Click on 'Continue as guest' button, wait for the page to load with wait, click on 'Add vaccines' button, select 'Flu' and click on 'Add vaccines'",
        f"Click on 'next' to enter the page with recommendation vaccines, then click on 'next' again, until on the page of entering zip code, enter '{args.zip_code}', select the first option from the dropdown menu, and click on 'Search'",
    ]

    tasker.set_task(instruction, todos)

    print(f"Starting task execution at {datetime.now()}")
    print("=" * 60)

    try:
        success = await tasker.execute(
            instruction="",
            action_handler=action_handler,
            image_provider=image_provider,
        )

        memory = tasker.get_memory()
        print("\n" + "=" * 60)
        print("EXECUTION SUMMARY")
        print(f"Overall success: {success}")
        print(memory.task_execution_summary)

        status_summary = memory.get_todo_status_summary()
        print(f"Completed: {status_summary.get('completed', 0)}")
    except Exception as exc:
        print(f"Error during execution: {exc}")
        traceback.print_exc()

    output_file = os.path.join(save_dir, "cvs_execution_history.html")
    observer.export("html", output_file)
    print(f"Exported execution history to {output_file}")


if __name__ == "__main__":
    asyncio.run(main())
```

## Run the Workflow

Launch the automation (make sure CVS is reachable and the browser window is visible):

```bash
python cvs_tasker.py \
  --first_name="Ada" \
  --last_name="Lovelace" \
  --email="ada@example.com" \
  --birthday="MM-DD-YYYY" \
  --zip_code="10001" \
  --model_name="lux-actor-1" \
  --max_steps=30
```

> Tip: Run inside a dedicated desktop Space to avoid accidental mouse/keyboard interruptions.

## Understanding the Output

- **Console summary** – Displays per-todo success, and aggregated stats pulled from the agent's memory object.
- **HTML export** – Stored under `results/<exp_name>/cvs_execution_history.html` with screenshot thumbnails, tool calls, and timestamps for every step (ideal proof for compliance or debugging).

## Troubleshooting

| Symptom | Likely cause | Fix |
| --- | --- | --- |
| `ImportError: AsyncPyautoguiActionHandler requires desktop dependencies` | Desktop extras not installed | `pip install oagi-core[desktop]` @oagi-python/src/oagi/__init__.py#35-93 |
| `ConfigurationError: OAGI API key must be provided` | Missing `OAGI_API_KEY` | Export env var or pass `api_key` directly. @oagi-python/src/oagi/client/base.py#42-58 |
| Agent stalls on a todo | UI element not visible yet | Increase `--max_steps`, add `wait` language inside the todo, or lower `--temperature` for deterministic retries. |

With this workflow you now have a reproducible CVS booking assistant powered by OAGI's desktop automation stack, complete with observability artifacts for every run.


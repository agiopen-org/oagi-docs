---
title: "Amazon Data Crawling"
description: "Use the OAGI Python SDK's TaskerAgent to crawl Amazon product pages and extract data."
icon: "amazon"
---

# Amazon Data Crawling Tutorial

Build a TaskerAgent that automates product research on Amazon‚Äînavigating to the site, searching for products, and sorting by best sellers.

## What You'll Build

- Automated browser navigation to Amazon
- Product search and sorting by best sellers
- Execution summary with todo status tracking
- HTML execution history for debugging

<Card title="Source Code" icon="github" href="https://github.com/agiopen-org/oagi-lux-samples">
  Clone the sample repository to get the complete source code for this tutorial.
</Card>

## Prerequisites

1. **OAGI credentials** ‚Äì Generate an API key at [developer.openagi.org](https://developer.openagi.org/) and export it in your shell:
   ```bash
   export OAGI_API_KEY=sk-your-key
   export OAGI_BASE_URL=https://api.agiopen.org
   ```
2. **Python ‚â• 3.10**:
   ```bash
   pip install "oagi>=0.10.1"
   ```
3. **A web browser** ‚Äì The agent will open new tabs and navigate to Amazon.

## Project Layout

If you cloned the [sample repository](https://github.com/agiopen-org/oagi-lux-samples), the source code is already available at:

```
tasker_examples/amazon_scraping/
‚îú‚îÄ‚îÄ amazon_scraping.py
```

Once you have a browser open, you can execute the script directly:

```bash
python tasker_examples/amazon_scraping/amazon_scraping.py
```

Or if you're following along, create your own file `amazon_scraping.py`:

## Tutorial Roadmap

We'll assemble the script in five steps:

1. Bootstrap the project with imports
2. Define the crawling workflow
3. Initialize and configure the agent
4. Execute the workflow
5. Export execution history

### Step 1 ‚Äî Bootstrap the project

Start with the imports you'll need:

```python
import argparse
import asyncio
import os
import traceback
from datetime import datetime

from oagi import AsyncScreenshotMaker
from oagi.agent.observer import AsyncAgentObserver
from oagi.agent.tasker import TaskerAgent
from oagi.handler import AsyncPyautoguiActionHandler


async def main():
    print("Bootstrapping Amazon Crawler‚Ä¶")


if __name__ == "__main__":
    asyncio.run(main())
```

### Step 2 ‚Äî Define the crawling workflow

Define the instruction and todos for the Amazon crawling task:

```python
    instruction = f"Find the information about the top-selling {args.product_name} on Amazon"
    todos = [
        f"Open a new tab, go to www.amazon.com, and search for {args.product_name} in the search bar",
        f"Click on 'Sort by' in the top right of the page and select 'Best Sellers'",
    ]
```

**Key tip:** When writing todos, be specific about UI element locations. For example, "in the top right of the page" helps the agent locate the correct element.

### Step 3 ‚Äî Initialize and configure the agent

Set up argument parsing and initialize all components:

```python
    parser = argparse.ArgumentParser(description='Crawl Amazon for product data')
    parser.add_argument('--product_name', type=str, default='purse', help='Product name to search for')
    parser.add_argument('--exp_name', type=str, default='amazon_crawl', help='Experiment name')
    parser.add_argument('--save_dir', type=str, default='results/', help='Directory to save results')
    parser.add_argument('--model_name', type=str, default='lux-actor-1', help='Model name')
    parser.add_argument('--max_steps', type=int, default=24, help='Max steps per todo')
    parser.add_argument('--temperature', type=float, default=0.0, help='Temperature')

    args = parser.parse_args()

    save_dir = os.path.join(args.save_dir, args.exp_name)
    os.makedirs(save_dir, exist_ok=True)

    # Initialize automation toolkit
    observer = AsyncAgentObserver()
    image_provider = AsyncScreenshotMaker()
    action_handler = AsyncPyautoguiActionHandler()

    tasker = TaskerAgent(
        api_key=os.getenv("OAGI_API_KEY"),
        base_url=os.getenv("OAGI_BASE_URL", "https://api.agiopen.org"),
        model=args.model_name,
        max_steps=args.max_steps,
        temperature=args.temperature,
        step_observer=observer,
    )

    tasker.set_task(task=instruction, todos=todos)
```

### Step 4 ‚Äî Execute the workflow

Run the agent and display the execution summary:

```python
    print(f"Starting task execution at {datetime.now()}")
    print(f"Task: {instruction}")
    print(f"Number of todos: {len(todos)}")
    print("=" * 60)

    try:
        success = await tasker.execute(
            instruction="",
            action_handler=action_handler,
            image_provider=image_provider,
        )

        memory = tasker.get_memory()

        print("\n" + "=" * 60)
        print("EXECUTION SUMMARY")
        print("=" * 60)
        print(f"Overall success: {success}")
        print(f"\nTask execution summary:\n{memory.task_execution_summary}")

        print("\nTodo Status:")
        for i, todo in enumerate(memory.todos):
            status_icon = {
                "completed": "‚úÖ",
                "pending": "‚è≥",
                "in_progress": "üîÑ",
                "skipped": "‚è≠Ô∏è",
            }.get(todo.status.value, "‚ùì")
            print(f"  {status_icon} [{i + 1}] {todo.description} - {todo.status.value}")

        status_summary = memory.get_todo_status_summary()
        print("\nExecution Statistics:")
        print(f"  Completed: {status_summary.get('completed', 0)}")
        print(f"  Pending: {status_summary.get('pending', 0)}")
        print(f"  In Progress: {status_summary.get('in_progress', 0)}")
        print(f"  Skipped: {status_summary.get('skipped', 0)}")

    except Exception as e:
        print(f"\n‚ùå Error during execution: {e}")
        traceback.print_exc()
```

### Step 5 ‚Äî Export execution history

Save the HTML execution history for debugging:

```python
    output_file = os.path.join(save_dir, f"{args.product_name}_execution_history.html")
    observer.export("html", output_file)
    print(f"\nüìÑ Execution history exported to: {output_file}")
```

## Run the Workflow

Launch the Amazon crawler:

```bash
python amazon_crawler.py --product_name="headphones"
```

## Understanding the Output

- **Console summary** ‚Äì Displays per-todo success with emoji indicators
- **HTML export** ‚Äì Full execution history with screenshots at `results/<exp_name>/<product_name>_execution_history.html`

## Full Source Listing

Here is the complete script assembled from the steps above:

```python
import argparse
import asyncio
import os
import traceback
from datetime import datetime

from oagi import AsyncScreenshotMaker
from oagi.agent.observer import AsyncAgentObserver
from oagi.agent.tasker import TaskerAgent
from oagi.handler import AsyncPyautoguiActionHandler


async def main():
    parser = argparse.ArgumentParser(description='Crawl Amazon for product data')
    parser.add_argument('--product_name', type=str, default='purse', help='Product name to search for')
    parser.add_argument('--exp_name', type=str, default='amazon_crawl', help='Experiment name')
    parser.add_argument('--save_dir', type=str, default='results/', help='Directory to save results')
    parser.add_argument('--model_name', type=str, default='lux-actor-1', help='Model name')
    parser.add_argument('--max_steps', type=int, default=24, help='Max steps per todo')
    parser.add_argument('--temperature', type=float, default=0.0, help='Temperature')

    args = parser.parse_args()

    save_dir = os.path.join(args.save_dir, args.exp_name)
    os.makedirs(save_dir, exist_ok=True)

    instruction = f"Find the information about the top-selling {args.product_name} on Amazon"
    todos = [
        f"Open a new tab, go to www.amazon.com, and search for {args.product_name} in the search bar",
        f"Click on 'Sort by' in the top right of the page and select 'Best Sellers'",
    ]

    observer = AsyncAgentObserver()
    image_provider = AsyncScreenshotMaker()
    action_handler = AsyncPyautoguiActionHandler()

    tasker = TaskerAgent(
        api_key=os.getenv("OAGI_API_KEY"),
        base_url=os.getenv("OAGI_BASE_URL", "https://api.agiopen.org"),
        model=args.model_name,
        max_steps=args.max_steps,
        temperature=args.temperature,
        step_observer=observer,
    )

    tasker.set_task(task=instruction, todos=todos)

    print(f"Starting task execution at {datetime.now()}")
    print(f"Task: {instruction}")
    print(f"Number of todos: {len(todos)}")
    print("=" * 60)

    try:
        success = await tasker.execute(
            instruction="",
            action_handler=action_handler,
            image_provider=image_provider,
        )

        memory = tasker.get_memory()

        print("\n" + "=" * 60)
        print("EXECUTION SUMMARY")
        print("=" * 60)
        print(f"Overall success: {success}")
        print(f"\nTask execution summary:\n{memory.task_execution_summary}")

        print("\nTodo Status:")
        for i, todo in enumerate(memory.todos):
            status_icon = {
                "completed": "‚úÖ",
                "pending": "‚è≥",
                "in_progress": "üîÑ",
                "skipped": "‚è≠Ô∏è",
            }.get(todo.status.value, "‚ùì")
            print(f"  {status_icon} [{i + 1}] {todo.description} - {todo.status.value}")

        status_summary = memory.get_todo_status_summary()
        print("\nExecution Statistics:")
        print(f"  Completed: {status_summary.get('completed', 0)}")
        print(f"  Pending: {status_summary.get('pending', 0)}")
        print(f"  In Progress: {status_summary.get('in_progress', 0)}")
        print(f"  Skipped: {status_summary.get('skipped', 0)}")

    except Exception as e:
        print(f"\n‚ùå Error during execution: {e}")
        traceback.print_exc()

    output_file = os.path.join(save_dir, f"{args.product_name}_execution_history.html")
    observer.export("html", output_file)
    print(f"\nüìÑ Execution history exported to: {output_file}")


if __name__ == '__main__':
    asyncio.run(main())
```

## Customizing the Workflow

To adapt this for different use cases:

1. **Change the product** ‚Äì Use `--product_name` to search for any product category
2. **Modify todos** ‚Äì Add steps like clicking into a product detail page or adding to cart
3. **Add more todos** ‚Äì Paginate through results or compare multiple products

Example with more detailed navigation:

```python
todos = [
    f"Open a new tab, go to www.amazon.com, and search for {args.product_name} in the search bar",
    f"Click on 'Sort by' in the top right of the page and select 'Best Sellers'",
    "Click on the first product in the search results",
    "Scroll down to see the product details and reviews",
]
```

## Troubleshooting

| Symptom | Likely cause | Fix |
| --- | --- | --- |
| Agent can't find search bar | Page layout changed or slow load | Add a wait step or be more specific in the todo |
| Sort dropdown not found | Amazon UI varies by region | Update todo with exact button text for your locale |
| Execution times out | Too many steps required | Increase `--max_steps` or simplify todos |

With this workflow you now have a reusable Amazon navigation pattern using OAGI's TaskerAgent for browser automation.